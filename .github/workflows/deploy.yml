name: Deploy
env:
    CI: false
on:
    push:
        branches:
            - master

jobs:
    deploy:
        runs-on: ubuntu-latest
        steps:
            # Клонирование репозитория
            - uses: actions/checkout@v2

            # Установка зависимостей и сборка проекта
            - run: npm ci
            - run: npm run build

            # Настройка SSH и использование rsync для деплоя
            - run: mkdir -p ~/.ssh
            - run: echo "$SSH_KEY" | tr -d '\r' > ~/.ssh/id_key
            - run: chmod 600 ~/.ssh/id_key
            - run:
                  rsync -e "ssh -p 22 -i $HOME/.ssh/id_key -o StrictHostKeyChecking=no" \
                  --archive --compress --delete -r ./build/ \
                  contest@51.250.41.208:/home/contest/olympus-front-end/
